<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login / Registratie — Budgetplanner</title>
  <style>
    :root{
      --bg:#f4f6f8;          /* app background */
      --card:#ffffff;        /* card background */
      --text:#111827;        /* primary text */
      --muted:#6b7280;       /* secondary text */
      --brand:#2563eb;       /* primary brand color */
      --brand-600:#1d4ed8;
      --ok:#10b981;
      --ring: 0 0 0 3px rgba(37,99,235,.15);
      --radius:14px;
      --shadow: 0 8px 24px rgba(0,0,0,.08);
      --border: 1px solid rgba(17,24,39,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background:var(--bg); color:var(--text); display:flex; align-items:center; justify-content:center; padding:24px; font-size:16.5px;
    }
    .shell{
      width:min(1180px,100%);
      display:grid; grid-template-columns: 1fr; gap:24px;
    }
    .brandbar{
      display:flex; align-items:center; gap:12px; padding:8px 4px; justify-content:center;
    }
    .logo-img{
      width:56px; height:56px; border-radius:12px; object-fit:cover; box-shadow:var(--shadow); display:none;
    }
    .logo-fallback{
      width:56px; height:56px; border-radius:12px; background:linear-gradient(135deg,#60a5fa,#a78bfa); display:flex; align-items:center; justify-content:center; color:white; font-weight:800; font-size:22px; box-shadow:var(--shadow);
    }
    .brandbar h1{font-size:18px; margin:0; font-weight:700}

    .card{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:28px; border:var(--border);
    }

    .tabs{display:flex; gap:8px; background:#eef2ff; border-radius:12px; padding:6px; margin-bottom:16px}
    .tab{flex:1; text-align:center; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; color:#334155; font-size:16px;}
    .tab.active{background:#fff; color:var(--brand); box-shadow:0 1px 2px rgba(0,0,0,.06)}

    .title{margin:0 0 8px; font-size:26px}
    .subtitle{margin:0 0 18px; color:var(--muted); font-size:16px}

    form{display:block}
    .grid{display:grid; grid-template-columns:1fr; gap:14px}
    @media (min-width:720px){ .grid.two{grid-template-columns:1fr 1fr} }
    /* removed .grid.three, not needed */
    /* password toggle */
    .passwrap{position:relative}
    .passwrap input{padding-right:44px}
    .toggle-pass{position:absolute; right:10px; top:50%; transform:translateY(-50%); background:transparent; border:1px solid transparent; cursor:pointer; padding:6px; border-radius:8px}
    .toggle-pass:focus{outline:none; box-shadow:var(--ring)}
    .toggle-pass svg{width:20px; height:20px; display:block}

    label{font-weight:600; font-size:14px; color:#374151; display:block; margin-bottom:6px}
    input, select{
      width:100%; padding:14px 14px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; font-size:16px; outline:none; transition:border .15s, box-shadow .15s;
    }
    input:focus, select:focus{border-color:var(--brand); box-shadow:var(--ring)}
    input.invalid{border-color:#ef4444; box-shadow:0 0 0 3px rgba(239,68,68,.15)}
    input.valid{border-color:#10b981;}
    .error{color:#b91c1c; font-size:12px; margin-top:6px; display:none}
    .error.show{display:block}
    .btn:disabled{opacity:.6; cursor:not-allowed}

    .actions{display:flex; gap:10px; align-items:center; margin-top:6px}
    .btn{
      appearance:none; border:none; border-radius:12px; padding:14px 18px; background:var(--brand); color:#fff; font-weight:700; cursor:pointer; width:100%; font-size:16px;
    }
    .btn:hover{background:var(--brand-600)}
    .form-message{margin-top:8px; font-size:14px; color:#b91c1c; display:none}
    .form-message.show{display:block}
    .form-message.ok{color:#065f46}
    .link{color:var(--brand); font-weight:600; cursor:pointer; text-decoration:none}

    .hidden{display:none}

    /* modal */
    .modal{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(2,6,23,.35); z-index:9999}
    .modal[aria-hidden="true"]{display:none}
    .modal .content{width:min(420px,92%); background:#fff; border-radius:16px; box-shadow:var(--shadow); padding:22px; border:var(--border); text-align:center}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:rgba(16,185,129,.12); color:#065f46; font-weight:700; font-size:12px; margin-bottom:8px}
  </style>
     <link rel="icon" sizes="32x32" href="favicon-32x32.png">
     <link rel="icon" sizes="48x48" href="favicon-48x48.png">
     <link rel="icon" sizes="96x96" href="favicon-96x96.png">
     <link rel="icon" sizes="192x192" href="Favicon-192x192.png">
     <link rel="apple-touch-icon" sizes="180x180" href="favicon-180x180.png">
     <link rel="shortcut icon" type="image/x-icon" href="favicon-48x48.ico">
</head>
<body>
  <div class="shell">
    <div class="brandbar">
      <img id="appLogo" class="logo-img" src="Budgetplanner.png" alt="Logo" />
      <div class="logo-fallback" aria-hidden="true">B</div>
      <h1>Budgetplanner</h1>
    </div>

    <div class="card">
      <div class="tabs" role="tablist">
        <div id="tab-login" class="tab active" role="tab" aria-controls="panel-login" aria-selected="true">Inloggen</div>
        <div id="tab-register" class="tab" role="tab" aria-controls="panel-register" aria-selected="false">Account aanmaken</div>
      </div>

      <!-- LOGIN -->
      <section id="panel-login" role="tabpanel" aria-labelledby="tab-login">
        <h2 class="title">Welkom terug</h2>
        <p class="subtitle">Log in met je gebruikersnaam en wachtwoord.</p>
        <form id="loginForm" novalidate>
          <div class="grid">
            <div>
              <label for="loginUsername">Gebruikersnaam</label>
              <input id="loginUsername" name="loginUsername" type="text" autocomplete="username" required minlength="3" />
              <small class="error" data-error-for="loginUsername"></small>
            </div>
            <div>
              <label for="loginPassword">Wachtwoord</label>
              <div class="passwrap">
                <input id="loginPassword" name="loginPassword" type="password" autocomplete="current-password" required minlength="6" />
                <button class="toggle-pass" type="button" aria-label="Toon/verberg wachtwoord" data-target="loginPassword">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </button>
              </div>
              <small class="error" data-error-for="loginPassword"></small>
            </div>
          </div>
          <div class="actions">
            <button class="btn" type="submit">Inloggen</button>
          </div>
          <div id="loginMsg" class="form-message"></div>
        </form>
      </section>

      <!-- REGISTER -->
      <section id="panel-register" class="hidden" role="tabpanel" aria-labelledby="tab-register">
        <h2 class="title">Nieuw account</h2>
        <p class="subtitle">Vul je gegevens in om een account te maken.</p>
        <form id="registerForm" novalidate>
          <div class="grid two">
            <div>
              <label for="regNaam">Naam</label>
              <input id="regNaam" name="regNaam" type="text" required />
              <small class="error" data-error-for="regNaam"></small>
            </div>
            <div>
              <label for="regVoornaam">Voornaam</label>
              <input id="regVoornaam" name="regVoornaam" type="text" required />
              <small class="error" data-error-for="regVoornaam"></small>
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="regGebruikersnaam">Gebruikersnaam</label>
              <input id="regGebruikersnaam" name="regGebruikersnaam" type="text" autocomplete="username" required minlength="3" />
              <small class="error" data-error-for="regGebruikersnaam"></small>
            </div>
            <div>
              <label for="regEmail">E‑mailadres</label>
              <input id="regEmail" name="regEmail" type="email" autocomplete="email" required pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$" />
              <small class="error" data-error-for="regEmail"></small>
            </div>
          </div>

          <div class="grid">
            <div>
              <label for="regPassword">Wachtwoord</label>
              <div class="passwrap">
                <input id="regPassword" name="regPassword" type="password" autocomplete="new-password" required minlength="8" pattern="(?=.*[A-Za-z])(?=.*\d).{8,}" />
                <button class="toggle-pass" type="button" aria-label="Toon/verberg wachtwoord" data-target="regPassword">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </button>
              </div>
              <small class="error" data-error-for="regPassword"></small>
            </div>
          </div>

          <div class="actions">
            <button class="btn" type="submit">Account aanmaken</button>
          </div>
          <div id="registerMsg" class="form-message"></div>
        </form>
      </section>
    </div>
  </div>

  <!-- Success Modal -->
  <div id="successModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="successTitle" aria-hidden="true" style="display:none">
    <div class="content">
      <div class="pill">Succes</div>
      <h3 id="successTitle" style="margin:6px 0 10px">Account succesvol aangemaakt</h3>
      <p class="subtitle" style="margin:0 0 16px">Je kan nu inloggen met je gebruikersnaam en wachtwoord.</p>
      <button id="successOk" class="btn" type="button">Ga naar login</button>
    </div>
  </div>

  <script>
    const tabLogin = document.getElementById('tab-login');
    const tabRegister = document.getElementById('tab-register');
    const panelLogin = document.getElementById('panel-login');
    const panelRegister = document.getElementById('panel-register');

    function debugLog(...args){ if(window && window.console){ console.log('[DEBUG]', ...args); } }

    function setValidity(el, ok, message=""){
      const err = document.querySelector(`.error[data-error-for="${el.id}"]`);
      if(ok){
        el.classList.remove('invalid'); el.classList.add('valid');
        if(err){ err.textContent=""; err.classList.remove('show'); }
      } else {
        el.classList.add('invalid'); el.classList.remove('valid');
        if(err){ err.textContent = message; err.classList.add('show'); }
      }
    }

    function checkField(el, decorate=true){
      const v = el.value.trim();
      let ok = true, msg = "";
      if(el.hasAttribute('required') && !v){ ok=false; msg='Dit veld is verplicht.'; }
      if(ok && el.id === 'regEmail'){
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/; ok = re.test(v); if(!ok) msg='Geef een geldig e‑mailadres op.';
      }
      if(ok && el.id === 'regPassword'){
        const re = /(?=.*[A-Za-z])(?=.*\d).{8,}/; ok = re.test(v); if(!ok) msg='Min. 8 tekens met letters en cijfers.';
      }
      if(ok && el.hasAttribute('minlength')){
        const ml = parseInt(el.getAttribute('minlength')); if(v.length < ml){ ok=false; msg=`Minimaal ${ml} tekens.`; }
      }
      if(decorate){ setValidity(el, ok, msg); }
      return ok;
    }
    // Password toggle logic
    document.querySelectorAll('.toggle-pass').forEach(btn=>{
      const input = document.getElementById(btn.dataset.target);
      if(!input) return;
      btn.addEventListener('click', ()=>{
        const toType = input.type === 'password' ? 'text' : 'password';
        input.type = toType;
        btn.setAttribute('aria-pressed', toType === 'text' ? 'true' : 'false');
      });
    });

    function bindValidation(form){
      const inputs = form.querySelectorAll('input');
      const submitBtn = form.querySelector('button[type="submit"]');
      let submitAttempted = false;

      function update(){
        let allOk = true;
        inputs.forEach(i=>{
          const shouldDecorate = submitAttempted || i.dataset.touched === 'true';
          const ok = checkField(i, shouldDecorate);
          if(!ok) allOk = false;
        });
        if(submitBtn){ submitBtn.disabled = !allOk; }
      }

      // Initial state: disable button if invalid, but do NOT decorate fields
      if(submitBtn){ submitBtn.disabled = !form.checkValidity(); }

      inputs.forEach(i=>{
        i.addEventListener('input', ()=>{
          i.dataset.touched = 'true';
          update();
        });
        i.addEventListener('blur', ()=>{
          i.dataset.touched = 'true';
          update();
        });
      });

      form.addEventListener('submit', (e)=>{
        submitAttempted = true; // from now on, show errors
        update();
        if(submitBtn && submitBtn.disabled){
          e.preventDefault();
          e.stopPropagation();
        }
      });
    }


    function showLogin(){
      tabLogin.classList.add('active'); tabRegister.classList.remove('active');
      panelLogin.classList.remove('hidden'); panelRegister.classList.add('hidden');
      tabLogin.setAttribute('aria-selected','true');
      tabRegister.setAttribute('aria-selected','false');
    }
    function showRegister(){
      tabRegister.classList.add('active'); tabLogin.classList.remove('active');
      panelRegister.classList.remove('hidden'); panelLogin.classList.add('hidden');
      tabRegister.setAttribute('aria-selected','true');
      tabLogin.setAttribute('aria-selected','false');
    }

    tabLogin.addEventListener('click', showLogin);
    tabRegister.addEventListener('click', showRegister);

    // Logo: toon PNG als beschikbaar (logo.png in dezelfde map)
    const logoImg = document.getElementById('appLogo');
    const logoFallback = document.querySelector('.logo-fallback');
    if(logoImg){
      const testImg = new Image();
      testImg.onload = () => { logoImg.style.display='block'; if(logoFallback) logoFallback.style.display='none'; };
      testImg.onerror = () => { logoImg.style.display='none'; if(logoFallback) logoFallback.style.display='flex'; };
      testImg.src = logoImg.getAttribute('src');
    }

    // Forms
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const modal = document.getElementById('successModal');
    const okBtn = document.getElementById('successOk');
    function showFormMessage(el, text, ok=false){
      if(!el) return; el.textContent = text; el.classList.add('show');
      if(ok){ el.classList.add('ok'); } else { el.classList.remove('ok'); }
    }
    bindValidation(registerForm);
    bindValidation(loginForm);

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const submitBtn = registerForm.querySelector('button[type="submit"]');
      if(!registerForm.checkValidity()){ registerForm.reportValidity(); return; }
      submitBtn.disabled = true;
      const msg = document.getElementById('registerMsg'); if(msg){ msg.classList.remove('show'); msg.textContent=''; }

      const data = new URLSearchParams();
      data.append('first_name', document.getElementById('regVoornaam').value.trim());
      data.append('last_name', document.getElementById('regNaam').value.trim());
      data.append('username', document.getElementById('regGebruikersnaam').value.trim());
      data.append('email', document.getElementById('regEmail').value.trim());
      data.append('password', document.getElementById('regPassword').value);

      try{
        const res = await fetch('register.php', {method:'POST', headers:{'Accept':'application/json'}, body:data});
        const raw = await res.text();
        let json;
        try { json = JSON.parse(raw); }
        catch { json = { ok:false, message:`Ongeldig serverantwoord (${res.status}).`, raw: raw.slice(0,400) }; }
        debugLog('register.php response:', json);
        if(json.ok){
          showFormMessage(msg, 'Account succesvol aangemaakt. Je kan nu inloggen.', true);
          modal.setAttribute('aria-hidden','false');
          modal.style.display = 'flex';
        } else {
          if(json.errors){
            Object.entries(json.errors).forEach(([id, m])=>{
              const el = document.getElementById(id);
              if(el){ setValidity(el, false, m); }
            });
          }
          showFormMessage(msg, json.message || 'Aanmaken mislukt. Probeer opnieuw.');
          if(json.raw){ showFormMessage(msg, (json.message||'') + "\n" + json.raw); }
        }
      } catch(err){
        showFormMessage(msg, 'Verbindingsfout. Controleer je netwerk.');
      } finally{
        submitBtn.disabled = false;
      }
    });
    okBtn.addEventListener('click', () => {
      modal.setAttribute('aria-hidden','true');
      modal.style.display = 'none';
      registerForm.reset();
      showLogin();
    });

    loginForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const submitBtn = loginForm.querySelector('button[type="submit"]');
      if(!loginForm.checkValidity()){ loginForm.reportValidity(); return; }
      submitBtn.disabled = true;
      const msg = document.getElementById('loginMsg'); if(msg){ msg.classList.remove('show'); msg.textContent=''; }

      const data = new URLSearchParams();
      data.append('username', document.getElementById('loginUsername').value.trim());
      data.append('password', document.getElementById('loginPassword').value);

      try{
        const res = await fetch('login.php', {method:'POST', headers:{'Accept':'application/json'}, body:data});
        const raw = await res.text();
        let json;
        try { json = JSON.parse(raw); }
        catch { json = { ok:false, message:`Ongeldig serverantwoord (${res.status}).`, raw: raw.slice(0,400) }; }
        debugLog('login.php response:', json);
        if(json.ok){
          showFormMessage(msg, 'Inloggen gelukt. Je wordt doorgestuurd...', true);
          // TODO: vervang door je echte app pagina
          window.location.href = json.redirect || 'app.php';
        } else {
          showFormMessage(msg, json.message || 'Gegevens onjuist.');
          if(json.raw){ showFormMessage(msg, (json.message||'') + "\n" + json.raw); }
        }
      } catch(err){
        showFormMessage(msg, 'Verbindingsfout. Probeer opnieuw.');
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>